.container-fluid#transactions
  .row
    .col-md-1
    .col-md-10.card

      %h1 Transactions
      .right
        = link_to 'Add Transaction', new_ac_transaction_path, class:"btn btn-primary"
        = link_to 'Schedule Transaction', new_ac_schedule_path, class:"btn btn-primary"      
      %table.table.table-striped
        %thead
          %tr
            %th Check 
            %th Date
            %th.left Payee
            %th.left Category
            %th Status
            %th Debit
            %th Credit
            %th Balance
            %th Description
            %th 


        %tbody
          - @ac_transactions.each do |ac_transaction|
            - @balance += ((ac_transaction.credit || 0 ) - (ac_transaction.debit || 0))
            %tr
              %td.right
                = ac_transaction.check_number
              %td.center
                = ac_transaction.date.strftime("%Y.%m.%d")
              %td.left
                = ac_transaction.ac_payee.name
              %td.left
                = "#{ac_transaction.ac_category.name}:#{ac_transaction.ac_sub_category.name}"
              %td.center
                %span.status-toggle{data: {id: ac_transaction.id, status: ac_transaction.ac_transaction_status.name[0,1]}} 
                  = ac_transaction.ac_transaction_status.name[0,1]
              %td.right
                = number_to_currency(ac_transaction.debit)
              %td.right
                = number_to_currency(ac_transaction.credit)
              %td.right
                = number_to_currency(@balance)
              %td= ac_transaction.description
              %td.center
                =link_to edit_ac_transaction_path(ac_transaction), title: "Edit Transaction" do
                  %i.bi.bi-pencil-square
          - @ac_schedules.each do |ac_schedule|
            - @balance += ((ac_schedule.credit || 0 ) - (ac_schedule.debit || 0))
            %tr.grayed
              %td.right
                               
              %td.center
                = ac_schedule.next_date.strftime("%Y.%m.%d")
              %td.left
                = ac_schedule.ac_payee.name
              %td.left
                = "#{ac_schedule.ac_category.name}:#{ac_schedule.ac_sub_category.name}"
              %td.center
                = "S"
              %td.right
                = number_to_currency(ac_schedule.debit)
              %td.right
                = number_to_currency(ac_schedule.credit)
              %td.right
                = number_to_currency(@balance)
              %td= ac_schedule.description
              %td.center
                =link_to new_ac_transaction_path(schedule_id: ac_schedule.id), title: "Insert Transaction" do
                  %i.bi.bi-plus-square
      %br

      
:javascript
  $( document ).ready(function() {
    $(".status-toggle").on( "click", function(){
      let s = $(this).data("status");
      let p = "P"
      let c = "C"

      if (s === p){
        $(this).html("C");
        $(this).data("status", "C")
      }else if (s === c){
        $(this).html("R");
        $(this).data("status", "R")
      }else{
        alert($(this).data("status"));
      }
    })
  })

